name: "Matrix All Activity Notifications"

on:
  # Issues
  issues:
    types: [opened, closed, reopened]
  # edited, assigned, unassigned, labeled, unlabeled, locked, unlocked, transferred, pinned, unpinned]

  # Issue Comments
  issue_comment:
    types: [created] #, edited, deleted]

  # Pull Requests
  pull_request:
    types: [opened] # , edited, closed]
  # , reopened, assigned, unassigned, review_requested, review_request_removed, labeled, unlabeled, synchronize, converted_to_draft, ready_for_review, locked, unlocked]

  # Pull Request Reviews
  pull_request_review:
    types: [submitted] # , edited, dismissed]

  # Pull Request Review Comments
  pull_request_review_comment:
    types: [created] #, edited, deleted]

  # Pushes to any branch AND tags
  push:
    branches: ['**']
    tags: ['**']

  # Releases
  release:
    types: [published] #, unpublished, created, edited, deleted, prereleased, released]

  # Stars
  #watch:
  #  types: [started]

  # Forks
  fork:

  # Discussions
  discussion:
    types: [created, answered] #, edited, deleted, pinned, unpinned, locked, unlocked, transferred, category_changed, answered, unanswered]

  # Discussion Comments
  discussion_comment:
    types: [created] #, edited, deleted]

  # Wiki
  gollum:

  # Milestones
  milestone:
    types: [closed] # [created, closed, opened, edited, deleted]

  # Labels
  #label:
  #  types: [created, edited, deleted]

  # Branch/Tag creation and deletion
  create:
  delete:

  # Deployment
  deployment:
  deployment_status:

  # Pages
  # page_build:

  # Repository dispatch
  # repository_dispatch:

  # Public (when repo goes public)
  public:

  # Check runs
  #check_run:
  #  types: [created, completed, rerequested, requested_action]

  # Check suites
  #check_suite:
  #  types: [completed, requested, rerequested]

  # Branch protection rules
  #branch_protection_rule:
  #  types: [created, edited, deleted]

  # Registry packages
  registry_package:
    types: [published, updated]

  # Status (commit status)
  status:

jobs:
  notify-matrix:
    runs-on: ubuntu-latest
    steps:
      - name: Determine activity type and format message
        id: format
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Action: ${{ github.event.action }}"

          # Set default values
          ICON="ðŸ“"
          TITLE="GitHub Activity"
          DESCRIPTION=""
          URL="${{ github.event.repository.html_url }}"
          ACTOR="${{ github.actor }}"

          case "${{ github.event_name }}" in
            "issues")
              ICON="ðŸ›"
              case "${{ github.event.action }}" in
                "opened") TITLE="New Issue Opened" ;;
                "closed") TITLE="Issue Closed" ;;
                "reopened") TITLE="Issue Reopened" ;;
                "edited") TITLE="Issue Edited" ;;
                "assigned") TITLE="Issue Assigned" ;;
                "labeled") TITLE="Issue Labeled" ;;
                *) TITLE="Issue ${{ github.event.action }}" ;;
              esac
              DESCRIPTION="${{ github.event.issue.title }}"
              URL="${{ github.event.issue.html_url }}"
              ;;
            "issue_comment")
              ICON="ðŸ’¬"
              TITLE="Issue Comment ${{ github.event.action }}"
              DESCRIPTION="On: ${{ github.event.issue.title }}"
              URL="${{ github.event.comment.html_url }}"
              ;;
            "pull_request")
              ICON="ðŸ”€"
              case "${{ github.event.action }}" in
                "opened") TITLE="New Pull Request" ;;
                "closed")
                  if [[ "${{ github.event.pull_request.merged }}" == "true" ]]; then
                    TITLE="Pull Request Merged"
                    ICON="âœ…"
                  else
                    TITLE="Pull Request Closed"
                  fi
                  ;;
                "reopened") TITLE="Pull Request Reopened" ;;
                "ready_for_review") TITLE="Pull Request Ready for Review" ;;
                *) TITLE="Pull Request ${{ github.event.action }}" ;;
              esac
              DESCRIPTION="${{ github.event.pull_request.title }}"
              URL="${{ github.event.pull_request.html_url }}"
              ;;
            "pull_request_review")
              ICON="ðŸ‘€"
              TITLE="Pull Request Review ${{ github.event.action }}"
              DESCRIPTION="On: ${{ github.event.pull_request.title }}"
              URL="${{ github.event.review.html_url }}"
              ;;
            "pull_request_review_comment")
              ICON="ðŸ’­"
              TITLE="PR Review Comment ${{ github.event.action }}"
              DESCRIPTION="On: ${{ github.event.pull_request.title }}"
              URL="${{ github.event.comment.html_url }}"
              ;;
            "push")
              ICON="ðŸ“¤"
              if [[ "${{ github.ref }}" == refs/tags/* ]]; then
                ICON="ðŸ·ï¸"
                TITLE="Tag Pushed"
                DESCRIPTION="Tag: ${{ github.ref_name }}"
              else
                TITLE="Push to ${{ github.ref_name }}"
                DESCRIPTION="${{ github.event.head_commit.message }}"
              fi
              URL="${{ github.event.compare }}"
              ;;
            "release")
              ICON="ðŸš€"
              TITLE="Release ${{ github.event.action }}"
              DESCRIPTION="${{ github.event.release.name || github.event.release.tag_name }}"
              URL="${{ github.event.release.html_url }}"
              ;;
            "watch")
              ICON="â­"
              TITLE="Repository Starred"
              DESCRIPTION="New watcher: ${{ github.actor }}"
              ;;
            "fork")
              ICON="ðŸ´"
              TITLE="Repository Forked"
              DESCRIPTION="By ${{ github.event.forkee.owner.login }}"
              URL="${{ github.event.forkee.html_url }}"
              ;;
            "discussion")
              ICON="ðŸ’¬"
              TITLE="Discussion ${{ github.event.action }}"
              DESCRIPTION="${{ github.event.discussion.title }}"
              URL="${{ github.event.discussion.html_url }}"
              ;;
            "discussion_comment")
              ICON="ðŸ’¬"
              TITLE="Discussion Comment ${{ github.event.action }}"
              DESCRIPTION="On: ${{ github.event.discussion.title }}"
              URL="${{ github.event.comment.html_url }}"
              ;;
            "gollum")
              ICON="ðŸ“–"
              TITLE="Wiki Updated"
              DESCRIPTION="Pages modified: ${{ join(github.event.pages.*.page_name, ', ') }}"
              ;;
            "milestone")
              ICON="ðŸŽ¯"
              TITLE="Milestone ${{ github.event.action }}"
              DESCRIPTION="${{ github.event.milestone.title }}"
              URL="${{ github.event.milestone.html_url }}"
              ;;
            "label")
              ICON="ðŸ·ï¸"
              TITLE="Label ${{ github.event.action }}"
              DESCRIPTION="${{ github.event.label.name }}"
              ;;
            "create")
              ICON="ðŸŒ±"
              TITLE="${{ github.event.ref_type }} Created"
              DESCRIPTION="${{ github.event.ref }}"
              ;;
            "delete")
              ICON="ðŸ—‘ï¸"
              TITLE="${{ github.event.ref_type }} Deleted"
              DESCRIPTION="${{ github.event.ref }}"
              ;;
            "deployment")
              ICON="ðŸš€"
              TITLE="Deployment"
              DESCRIPTION="Environment: ${{ github.event.deployment.environment }}"
              ;;
            "deployment_status")
              ICON="ðŸš€"
              TITLE="Deployment Status"
              DESCRIPTION="State: ${{ github.event.deployment_status.state }}"
              URL="${{ github.event.deployment_status.target_url }}"
              ;;
            "page_build")
              ICON="ðŸ“„"
              TITLE="Page Build"
              DESCRIPTION="GitHub Pages build"
              ;;
            "repository_dispatch")
              ICON="ðŸ“¡"
              TITLE="Repository Dispatch"
              DESCRIPTION="Event type: ${{ github.event.action }}"
              ;;
            "public")
              ICON="ðŸŒ"
              TITLE="Repository Made Public"
              DESCRIPTION="Repository is now public"
              ;;
            "check_run")
              ICON="âœ…"
              TITLE="Check Run ${{ github.event.action }}"
              DESCRIPTION="${{ github.event.check_run.name }}"
              URL="${{ github.event.check_run.html_url }}"
              ;;
            "check_suite")
              ICON="âœ…"
              TITLE="Check Suite ${{ github.event.action }}"
              DESCRIPTION="Conclusion: ${{ github.event.check_suite.conclusion }}"
              URL="${{ github.event.check_suite.html_url }}"
              ;;
            "branch_protection_rule")
              ICON="ðŸ›¡ï¸"
              TITLE="Branch Protection Rule ${{ github.event.action }}"
              DESCRIPTION="Rule updated"
              ;;
            "registry_package")
              ICON="ðŸ“¦"
              TITLE="Package ${{ github.event.action }}"
              DESCRIPTION="${{ github.event.package.name }}"
              URL="${{ github.event.package.html_url }}"
              ;;
            "status")
              ICON="ðŸ”"
              TITLE="Status Update"
              DESCRIPTION="State: ${{ github.event.state }}"
              URL="${{ github.event.target_url }}"
              ;;
            *)
              TITLE="${{ github.event_name }} ${{ github.event.action }}"
              ;;
          esac

          # Output variables
          echo "icon=$ICON" >> $GITHUB_OUTPUT
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "description=$DESCRIPTION" >> $GITHUB_OUTPUT
          echo "url=$URL" >> $GITHUB_OUTPUT
          echo "actor=$ACTOR" >> $GITHUB_OUTPUT

      - name: Send Matrix notification
        uses: lkiesow/matrix-notification@v1
        with:
          server: matrix.org
          token: ${{ secrets.MATRIX_TOKEN }}
          room: '!azsMvrsrqEENIcSLOe:matrix.org'
          message: |
            ${{ steps.format.outputs.icon }} ${{ steps.format.outputs.title }}

            Actor: ${{ steps.format.outputs.actor }}
            Repository: ${{ github.repository }}
            ${{ steps.format.outputs.description && format('Details: {0}', steps.format.outputs.description) || '' }}

            Link: ${{ steps.format.outputs.url }}
          formatted_message: |
            ${{ steps.format.outputs.icon }} <b>${{ steps.format.outputs.title }}</b><br><br>
            <b>Actor:</b> ${{ steps.format.outputs.actor }}<br>
            <b>Repository:</b> ${{ github.repository }}<br>
            ${{ steps.format.outputs.description && format('<b>Details:</b> {0}<br>', steps.format.outputs.description) || '' }}
            <br><b>Link:</b> <a href="${{ steps.format.outputs.url }}">${{ steps.format.outputs.url }}</a>

