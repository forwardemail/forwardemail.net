[Unit]
Description=SSH Security Monitor
After=network.target
Docs=https://github.com/forwardemail/forwardemail.net

[Service]
Type=oneshot
Environment="MSMTP_RCPTS={{ lookup('env', 'MSMTP_RCPTS') | default('security@forwardemail.net', true) }}"
Environment="SSH_MONITOR_ACTIVITY_RATE_LIMIT={{ lookup('env', 'SSH_MONITOR_ACTIVITY_RATE_LIMIT') | default('3600', true) }}"
Environment="SSH_MONITOR_FAILED_RATE_LIMIT={{ lookup('env', 'SSH_MONITOR_FAILED_RATE_LIMIT') | default('1800', true) }}"
Environment="SSH_MONITOR_ROOT_RATE_LIMIT={{ lookup('env', 'SSH_MONITOR_ROOT_RATE_LIMIT') | default('0', true) }}"
Environment="SSH_MONITOR_FAILED_THRESHOLD={{ lookup('env', 'SSH_MONITOR_FAILED_THRESHOLD') | default('5', true) }}"
ExecStart=/usr/local/bin/ssh-security-monitor.sh
StandardOutput=journal
StandardError=journal
SyslogIdentifier=ssh-security-monitor
User=root
Group=root

[Install]
WantedBy=multi-user.target
