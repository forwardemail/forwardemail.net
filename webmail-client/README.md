# ForwardEmail Webmail Client

Pure client-side PWA for ForwardEmail webmail. Built with Vite and Knockout.

## Getting Started

```bash
cd webmail-client
pnpm install
pnpm dev
pnpm build
pnpm lint         # eslint:recommended + prettier
pnpm format       # check formatting
pnpm format:write # apply prettier formatting
pnpm prepare      # installs Husky git hooks (runs automatically after install)
```

Git hooks: Husky pre-commit runs lint-staged (`prettier --write` + `eslint --fix` on staged files).

You can override the API base in a local `.env`:

```
WEBMAIL_API_BASE=https://api.forwardemail.net
WEBMAIL_MOCK=1    # keep mock data instead of calling API (optional)
```

## CI/CD

- Workflow: `.github/workflows/ci.yml` runs `pnpm lint`/`pnpm test` when present, builds the app, and deploys the `dist/` output to R2 on pushes to `main`.
- Repository/environment variables: `R2_BUCKET` (the Cloudflare R2 bucket name).
- Secrets: `R2_ACCOUNT_ID`, `R2_ACCESS_KEY_ID`, `R2_SECRET_ACCESS_KEY` (S3 API credentials from your R2 namespace).

## Assets Needed

- Fonts in `public/fonts` (`NunitoSans-Regular/Bold` and `VCHoney-Regular` as `.woff2`/`.woff`)
- PWA icons exist as gradient placeholders in `public/icons` (`icon-192.png`, `icon-512.png`); replace with final maskable-safe assets when ready

## Notes

- `index.html` renders the login card and registers the service worker; `/mailbox` shows a skeleton (folders/list/reader) with sample data until the full UI is built.
- `src/main.js` boots Knockout bindings and the animated starfield.
- API calls are routed through `src/utils/remote.js` to `https://api.forwardemail.net`.
- Service worker is generated by VitePWA (`/sw.js`) using the config in `vite.config.js`; we supply our own `public/manifest.json`.
- Basic auth is always stored (`webmail_alias_auth`) after login for mailbox decryption; requests use this header even if a token is returned.
- Message bodies are sanitized with DOMPurify before rendering in the reader pane.
- Compose modal exists (To/Subject with TipTap rich text body, posts to `/v1/messages` into `Sent Mail`); attachments sent as base64 with encoding flag; CC/BCC toggle; Ctrl/Cmd+Enter to send; plain text toggle.
- Settings modal stores an API key in `webmail_api_key` (used for `/v1/emails` sends); when absent, alias auth is used.
- Theme toggle (system/light/dark) stored in `webmail_theme` and applied on load; light mode overrides key surfaces/text colors.
