include ../../_sort-header
include ../../_pagination

.table-responsive
  table.table.table-hover.table-bordered.table-sm
    thead.thead-dark
      tr
        th(scope="col", style="width: 200px;")
          +sortHeader('email', 'From', '#table-inquiries')
        th.text-center.align-middle(scope="col", style="width: 350px;")= t("Subject & Preview")
        th(scope="col", style="width: 100px;")
          +sortHeader('plan', 'Plan', '#table-inquiries')
        th(scope="col", style="width: 120px;")
          +sortHeader('reference', 'Reference', '#table-inquiries')
        th(scope="col", style="width: 120px;")
          +sortHeader('created_at', 'Created', '#table-inquiries')
        th.text-center.align-middle(scope="col", style="width: 150px;")= t("Actions")
    tbody
      if inquiries.length === 0
        tr
          td.text-center.py-4(colspan="5")
            .alert.alert-info.mb-0= t("No inquiries exist for that search.")
      else
        each inquiry in inquiries
          tr(class=inquiry.is_resolved ? 'bg-white text-dark' : 'bg-white text-dark')
            td.align-middle
              a.text-primary(
                href=l(`/admin/users?mongodb_query={ email: "${inquiry.email}" }`),
                target="_blank",
                rel="noopener noreferrer"
              )= inquiry.email
            td.align-middle
              .d-flex.flex-column
                .font-weight-medium.text-truncate(style="max-width: 280px;", title=inquiry.subject || '[No Subject]')
                  = inquiry.subject || '[No Subject]'
                small.text-muted.text-truncate(style="max-width: 280px;")
                  = inquiry.message ? inquiry.message.substring(0, 100) + (inquiry.message.length > 100 ? '...' : '') : ''
                .mt-1
                  if inquiry.has_attachment
                    span.badge.badge-info.badge-sm.mr-1
                      i.fa.fa-paperclip.mr-1
                      = t("Attachment")
                  if inquiry.thread_id
                    span.badge.badge-secondary.badge-sm.mr-1
                      i.fa.fa-comments.mr-1
                      = t("Thread")
            td.align-middle
              = titleize(humanize(inquiry.plan || "none"))
            td.align-middle
              = inquiry.reference || "none"
            td.align-middle.dayjs(
              data-time=new Date(inquiry.created_at).getTime()
            )= dayjs(inquiry.created_at).tz(user.timezone === 'Etc/Unknown' ? 'UTC' : user.timezone).format("M/D/YY h:mm A z")
            td.align-middle
              .btn-group.btn-group-sm(role="group", aria-label=t("Actions"))
                a.btn.btn-primary(
                  href=l(`/admin/inquiries/${inquiry.id}`),
                  data-toggle="tooltip",
                  data-title=t("Reply")
                ): i.fa.fa-fw.fa-reply
                if !inquiry.is_resolved
                  form.ajax-form.confirm-prompt.btn-group(
                    action=l(`/admin/inquiries/${inquiry.id}`),
                    method="POST",
                    autocomplete="off"
                  )
                    input(type="hidden", name="_method", value="PUT")
                    button.btn.btn-success(
                      type="submit",
                      data-toggle="tooltip",
                      data-title=t("Mark as Resolved")
                    ): i.fa.fa-fw.fa-check
+paginate('#table-inquiries')
